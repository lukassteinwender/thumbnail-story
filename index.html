<!DOCTYPE html>
<html>

<style>
    body {
        background-color:	#282b30;
    }

    #main {
        text-align: center;
        display: block;
        margin-left: auto;
        margin-right: auto;
        height: 800px;
    }

    #btn {
        
        border: 0;
        outline: 0;
        cursor: pointer;
        color: white;
        background-color: rgb(84, 105, 212);
        box-shadow: rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 12%) 0px 1px 1px 0px, rgb(84 105 212) 0px 0px 0px 1px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(60 66 87 / 8%) 0px 2px 5px 0px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        padding: 4px 8px;
        display: inline-block;
        min-height: 28px;
        transition: background-color .24s,box-shadow .24s;
        :hover {
            box-shadow: rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 12%) 0px 1px 1px 0px, rgb(84 105 212) 0px 0px 0px 1px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(60 66 87 / 8%) 0px 3px 9px 0px, rgb(60 66 87 / 8%) 0px 2px 5px 0px;
        }
                
    }
</style>

<head>
    <title>Thumbnail Story</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
</head>

<body>
    <span id="loader" style="font-family: Roboto;"></span>
    <div id="main">
        <br><br>
        <!-- <button id="btn" onclick="downloadScript()">Download</button> -->
        <br> <br>
        <canvas id="Canvas" width="1080" height="1920"></canvas>
        <script>
        window.onload = function () {
            const apiKey = 'AIzaSyBWu7ByqOMONYL6w_pHZK1Q_i-TvRON4UQ';
            const channelId = 'UCpOjsfioBK7vgfT7AZXvx4A';
            let latestVideoId; // Globale Variable
            let latestVideoTitle;

            async function getLatestVideoId() {
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${apiKey}&channelId=${channelId}&part=snippet&order=date&type=video`);
                const data = await response.json();
                
                latestVideoId = data.items[0].id.videoId;
                latestVideoTitle = data.items[0].snippet.title;
                console.log(latestVideoTitle);
            } catch (error) {
                console.error('Fehler beim Abrufen der Daten von YouTube API:', error.message);
                // Handle error if needed
            }
            }

            // Funktion aufrufen und auf Abschluss warten
            getLatestVideoId().then(() => {
                var youtube_video_id = latestVideoId;
                var video_thumbnail = document.createElement("IMG");
                var src = 'http://img.youtube.com/vi/'+youtube_video_id+'/maxresdefault.jpg';
                video_thumbnail.src = src;
                
                var canvas = document.getElementById('Canvas');
                var ctx = canvas.getContext('2d');

                var bild1 = new Image();
                var bild2 = new Image();
                // Funktion zum Laden eines Bildes
                function ladeBild(src, callback) {
                    var bild = new Image();
                    bild.onload = function() {
                    callback(bild);
                    };
                    bild.src = src;
                }

                // Funktion zum Kombinieren von zwei Bildern auf dem Canvas
                function kombiniereBilder(bild1, bild2) {
                    // Zeichne das erste Bild auf das Canvas
                    ctx.drawImage(bild1, 0, 0, canvas.width, canvas.height);

                    // Zeichne das zweite Bild auf das Canvas
                    ctx.drawImage(bild2, 0, 400, canvas.width, 608);
                    
                    document.getElementById("loader").style.display="none"
                    ctx.font = '45px Roboto';
                    ctx.fillStyle = "#ffffff";
                    const txt = insertNewlineEveryXCharacters(latestVideoTitle, 25);
                    const x = 100;
                    const y = 1080;
                    const lineheight = 45;
                    const lines = txt.split('\n');
                    for (let i = 0; i < lines.length; i++) {
                        ctx.fillText(lines[i], x, y + (i * lineheight));
                    }
                }

                function insertNewlineEveryXCharacters(inputString, x) {
                    let result = '';
                    for (let i = 0; i < inputString.length; i++) {
                        result += inputString[i];
                        if ((i + 1) >= x && inputString[i] == " ") {
                            result += '\n';
                        }
                    }
                    return result;
                }

                // Pfade zu den Bildern
                var pfadBild1 = "background.jpg";
                var pfadBild2 = src;

                // Lade die Bilder und kombiniere sie
                ladeBild(pfadBild1, function(bild1) {
                    ladeBild(pfadBild2, function(bild2) {
                    kombiniereBilder(bild1, bild2);
                    });
                });
            });
        }
        </script>
    </div>
</body>

</html>