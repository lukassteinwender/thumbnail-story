<!DOCTYPE html>
<html>

<style>
    body {
        background-color: #282b30;
    }

    #main {
        text-align: center;
        display: block;
        margin-left: auto;
        margin-right: auto;
        height: 800px;
    }

    #btn {
        border: 0;
        outline: 0;
        cursor: pointer;
        color: white;
        background-color: rgb(84, 105, 212);
        box-shadow: rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 12%) 0px 1px 1px 0px, rgb(84 105 212) 0px 0px 0px 1px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(0 0 0 / 0%) 0px 0px 0px 0px, rgb(60 66 87 / 8%) 0px 2px 5px 0px;
        border-radius: 4px;
        font-size: 14px;
        font-weight: 500;
        padding: 15px 30px;
        display: inline-block;
        min-height: 28px;
        transition: background-color .24s, box-shadow .24s;
    }

    .circle-btn {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        cursor: pointer;
        display: inline-block;
        margin: 10px;
        overflow: hidden;
        border: 3px solid #fff;
    }

    #canvas-container {
        position: relative;
    }

</style>

<head>
    <title>Thumbnail Story</title>
    <link rel="stylesheet" href="https://corsproxy.io/?https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
</head>

<body>
    <span id="loader" style="font-family: Roboto;"></span>
    <div id="main">
        <div id="canvas-container">
            <!-- Buttons for selecting channels -->
            <div class="circle-btn" id="epicstunBtn" onclick="loadChannelData('UCpOjsfioBK7vgfT7AZXvx4A', 'EpicStun')">
                <img id="epicstunProfile" src="epicstun_profile.jpg" alt="EpicStun" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <div class="circle-btn" id="dreemtumBtn" onclick="loadChannelData('UC_dreemtum', 'Dreemtum')">
                <img id="dreemtumProfile" src="dreemtum_profile.jpg" alt="Dreemtum" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <canvas id="Canvas" width="1080" height="1920"></canvas>
        </div>

        <br><br>
        <button id="btn" onclick="downloadCanvas()"><b><h1>Download</h1></b></button>
        <button id="btn" onclick="copyLink()"><b><h1>Copy Video-URL</h1></b></button>

        <br> <br>
        <div id="link">
            <p style='color:white;'></p>
        </div>

        <script>
            let canvas = document.getElementById('Canvas');
            let ctx = canvas.getContext('2d');
            let videoSrc = "";
            
            async function loadChannelData(channelId, channelName) {
                const apiKey = 'AIzaSyBWu7ByqOMONYL6w_pHZK1Q_i-TvRON4UQ'; // Replace with your actual YouTube API key
                document.getElementById("loader").innerText = `Loading data for ${channelName}...`;
                
                try {
                    const videoResponse = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${apiKey}&channelId=${channelId}&part=snippet&order=date&type=video`);
                    const videoData = await videoResponse.json();
                    const latestVideoId = videoData.items[0].id.videoId;
                    const latestVideoTitle = videoData.items[0].snippet.title;

                    const channelResponse = await fetch(`https://www.googleapis.com/youtube/v3/channels?key=${apiKey}&id=${channelId}&part=snippet`);
                    const channelData = await channelResponse.json();
                    const profilePicURL = channelData.items[0].snippet.thumbnails.high.url;

                    const videoDetailsResponse = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails&id=${latestVideoId}&key=${apiKey}`);
                    const videoDetailsData = await videoDetailsResponse.json();
                    const duration = videoDetailsData.items[0].contentDetails.duration;

                    videoSrc = 'https://youtube.com/watch?v=' + latestVideoId;
                    document.getElementById("loader").innerText = '';

                    drawCanvas(latestVideoTitle, profilePicURL, channelName, duration, latestVideoId);

                } catch (error) {
                    console.error('Error fetching data from YouTube API:', error.message);
                    document.getElementById("loader").innerText = `Failed to load data for ${channelName}`;
                }
            }

            function drawCanvas(videoTitle, profilePicURL, channelName, duration, videoId) {
                const videoThumbnail = new Image();
                videoThumbnail.crossOrigin = 'anonymous';
                videoThumbnail.src = `https://corsproxy.io/?https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;

                videoThumbnail.onload = function () {
                    ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas before drawing
                    ctx.drawImage(videoThumbnail, 0, 0, canvas.width, 1080);

                    const profilePic = new Image();
                    profilePic.crossOrigin = 'anonymous';
                    profilePic.src = `https://corsproxy.io/?${profilePicURL}`;

                    profilePic.onload = function () {
                        ctx.drawImage(profilePic, 30, 1040, 80, 80);
                        ctx.font = '400 45px Roboto';
                        ctx.fillStyle = "#ffffff";
                        ctx.fillText(videoTitle, 150, 1085);
                    };
                };
            }

            function copyLink() {
                navigator.clipboard.writeText(videoSrc);
            }

            function downloadCanvas() {
                var dataUrl = canvas.toDataURL('image/png');
                var link = document.createElement('a');
                link.href = dataUrl;
                link.download = 'thumbnail.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        </script>
    </div>
</body>

</html>
